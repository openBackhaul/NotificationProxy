# Notifications: <br>

Below are SDN controller supported notification streams  <br>
1. [ODL level notifications](subscription.md#1-odl-level-notifications) <br>
2. [Device level notifications](subscription.md#2-device-level-notifications-subscription-procedure-prior-to-odl-v506) <br>

<br>
<img src="prior_odl_5.0.6.JPG">
<br>

## 1. ODL level notifications: <br>

ODL uses the publish-subscribe model for notifications, where applications can subscribe to specific types of events or data updates they are interested in. <br>
When a relevant event occurs, ODL notifies the subscribed applications, allowing them to take appropriate actions or make decisions based on the received information.<br>
ODL notification supports both http and https, also response will be in json format. <br>

ODL notification is classified into two based on the events generated from datastore <br>
&nbsp;<em>A. Configuration Stream </em><br>
&nbsp;<em>B. Operation Stream</em> <br>
	
&nbsp;&nbsp;**A. Configuration stream** <br>
&nbsp;&nbsp;By subscribing to the notification stream, your application or system can receive the notifications generated by the ODL controller based on the configured events or data changes. <br>
&nbsp;&nbsp;**Steps to start configuration subscription stream** <br>
&nbsp;&nbsp;Step-1: Create data change event stream for configuration datastore 
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/sal-remote:create-data-change-event-subscription
		BODY		:
				{
				"input": {
        			"path": "/network-topology:network-topology",
        			"sal-remote-augment:datastore": "CONFIGURATION",
        			"sal-remote-augment:scope": "SUBTREE",
        			"sal-remote-augment:notification-output-type": "JSON"  } }
```
&nbsp;&nbsp;Step-2: Get the streaming path for configurational data change events for all mounted nodes
```
		Operation	: GET
		URL		: http://172.28.127.3:8181/rests/data/ietf-restconf-monitoring:restconf-state/streams/stream/data-change-event-subscription/network-topology:network-topology/datastore=CONFIGURATION/scope=SUBTREE/JSON?changed-leaf-nodes-only=true
		Response	:
				{
			"subscribe-to-notification:location": "http://172.28.127.3:8181/rests/notif/data-change-event-subscription/network-topology:network-topology/datastore=CONFIGURATION/scope=SUBTREE/JSON"
				}
```
&nbsp;&nbsp;Step-3: Copy the response url from step-2, paste it in browser or any rest application which support streaming. 
&nbsp;&nbsp;We will get response like below 
```
		:ping
		:ping
		:ping
```
&nbsp;&nbsp;**B. Operation stream** <br>
&nbsp;&nbsp;In OpenDaylight (ODL), the operational stream is a built-in notification stream that provides real-time updates on operational data changes in the network. <br>
&nbsp;&nbsp;It allows you to subscribe to data resources and receive notifications whenever there are changes to that data <br>
&nbsp;&nbsp;**Steps to start operation subscription stream** <br>
&nbsp;&nbsp;Step-1: Create data change event stream for operational datastore 
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/sal-remote:create-data-change-event-subscription
		BODY		:
				{
					"input": {
       			 	 	"path": "/network-topology:network-topology",
      			  		"sal-remote-augment:datastore": "OPERATIONAL",
      			  		"sal-remote-augment:scope": "SUBTREE",
        		  		"sal-remote-augment:notification-output-type": "JSON" } }
```	
&nbsp;&nbsp;Step-2: Get the streaming path for operatrional data change events for all mounted nodes
```
		Operation	: GET
		URL		: http://172.28.127.3:8181/rests/data/ietf-restconf-monitoring:restconf-state/streams/stream/data-change-event-subscription/network-topology:network-topology/datastore=OPERATIONAL/scope=SUBTREE/JSON?changed-leaf-nodes-only=true
		Response	:
				{
			"subscribe-to-notification:location": "http://172.28.127.3:8181/rests/notif/data-change-event-subscription/network-topology:network-topology/datastore=OPERATIONAL/scope=SUBTREE/JSON"
				}
```	
&nbsp;&nbsp;Step-3: Copy the response url from step-2, paste it in browser or any rest application which support streaming. 
&nbsp;&nbsp;We will get response like below 
```
		:ping
		:ping
		:ping
```
&nbsp;&nbsp;After subscribing both configuration and operational stream, events can be triggered using below steps: <br>
&nbsp;&nbsp;If any attribute on configuration datastore is modified, device on the controller will get disconnected and reconnecte an corresponding operational data events will also get raised. <br>
		
#### <em>Mounting device on the SDN controller</em> <br>
		
```
		Operation	: PUT
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009
		BODY		:
			{
			"network-topology:node": [
				{
					"node-id": "513250009",
					"netconf-node-topology:sleep-factor": "2.5",
					"netconf-node-topology:max-connection-attempts": 8,
					"netconf-node-topology:username": "admin",
					"netconf-node-topology:password": "admin",
					"netconf-node-topology:schema-cache-directory": "siae_alcp2e",
					"netconf-node-topology:port": 33001,
					"netconf-node-topology:reconnect-on-changed-schema": false,
					"netconf-node-topology:tcp-only": false,
					"netconf-node-topology:keepalive-delay": 120,
					"netconf-node-topology:concurrent-rpc-limit": 0,
					"netconf-node-topology:host": "172.28.127.8"
					}
				]
			}
```						
				
&nbsp;&nbsp;Configuration Notification:
```
data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-TBD-params-xml-ns-yang-network-topology:node-id","data":{"network-topology:node-id":"513250009"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:sleep-factor","data":{"netconf-node-topology:sleep-factor":"2.5"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:max-connection-attempts","data":{"netconf-node-topology:max-connection-attempts":8},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:credentials/urn-opendaylight-netconf-node-topology:username","data":{"netconf-node-topology:username":"admin"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:credentials/urn-opendaylight-netconf-node-topology:password","data":{"netconf-node-topology:password":"admin"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:schema-cache-directory","data":{"netconf-node-topology:schema-cache-directory":"siae_alcp2e"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:port","data":{"netconf-node-topology:port":33001},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:reconnect-on-changed-schema","data":{"netconf-node-topology:reconnect-on-changed-schema":false},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:tcp-only","data":{"netconf-node-topology:tcp-only":false},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:keepalive-delay","data":{"netconf-node-topology:keepalive-delay":120},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:concurrent-rpc-limit","data":{"netconf-node-topology:concurrent-rpc-limit":0},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:host","data":{"netconf-node-topology:host":"172.28.127.8"},"operation":"created"}]},"event-time":"2023-07-11T08:21:50.526721696Z"}}
```

&nbsp;&nbsp;Operational Notification:
```	
data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-TBD-params-xml-ns-yang-network-topology:node-id","data":{"network-topology:node-id":"513250009"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:port","data":{"netconf-node-topology:port":33001},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:connection-status","data":{"netconf-node-topology:connection-status":"connecting"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:host","data":{"netconf-node-topology:host":"172.28.127.8"},"operation":"created"}]},"event-time":"2023-07-11T08:21:50.526891736Z"}}
```
		
#### <em>Editing device attribute on the SDN controller</em> <br>
```
		Operation	: PUT
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009/netconf-node-topology:max-connection-attempts
		BODY		:
				{
					"netconf-node-topology:max-connection-attempts": 7
				}
```
		
&nbsp;&nbsp;Configuration Notification:
```
data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:max-connection-attempts","data":{"netconf-node-topology:max-connection-attempts":7},"operation":"updated"}]},"event-time":"2023-07-11T08:38:29.086561862Z"}}
```
		
&nbsp;&nbsp;Operational Notifications:
```
data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:connection-status","data":{"netconf-node-topology:connection-status":"connecting"},"operation":"updated"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:session-id","operation":"deleted"}]},"event-time":"2023-07-11T08:38:29.087239632Z"}}

data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-TBD-params-xml-ns-yang-network-topology:node-id","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:port","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:connection-status","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:host","operation":"deleted"}]},"event-time":"2023-07-11T08:38:29.097251371Z"}}

data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-TBD-params-xml-ns-yang-network-topology:node-id","data":{"network-topology:node-id":"513250009"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:port","data":{"netconf-node-topology:port":33001},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:connection-status","data":{"netconf-node-topology:connection-status":"connecting"},"operation":"created"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:host","data":{"netconf-node-topology:host":"172.28.127.8"},"operation":"created"}]},"event-time":"2023-07-11T08:38:29.097669461Z"}}

data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:connection-status","data":{"netconf-node-topology:connection-status":"connected"},"operation":"updated"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:session-id","data":{"netconf-node-topology:session-id":1},"operation":"created"}]},"event-time":"2023-07-11T08:38:29.280265086Z"}}
```
#### <em>Deleting mounted device from the SDN controller</em> <br>
```
		Operation	: DELETE
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009
```						
				
&nbsp;&nbsp;Configuration Notification:
```
data: {"urn-ietf-params-xml-ns-netconf-notification-1.0:notification":{"urn-opendaylight-params-xml-ns-yang-controller-md-sal-remote:data-changed-notification":{"data-change-event":[{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-TBD-params-xml-ns-yang-network-topology:node-id","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:sleep-factor","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:max-connection-attempts","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:credentials/urn-opendaylight-netconf-node-topology:username","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:credentials/urn-opendaylight-netconf-node-topology:password","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:schema-cache-directory","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:port","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:reconnect-on-changed-schema","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:tcp-only","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:keepalive-delay","operation":"deleted"},{"path":"/urn-TBD-params-xml-ns-yang-network-topology:network-topology/urn-TBD-params-xml-ns-yang-network-topology:topology/urn-TBD-params-xml-ns-yang-network-topology:topology[urn-TBD-params-xml-ns-yang-network-topology:topology-id='topology-netconf']/urn-TBD-params-xml-ns-yang-network-topology:node/urn-TBD-params-xml-ns-yang-network-topology:node[urn-TBD-params-xml-ns-yang-network-topology:node-id='513250009']/urn-opendaylight-netconf-node-topology:host","operation":"deleted"}]},"event-time":"2023-07-10T11:33:54.374842218Z"}}
```
		
## 2. Device level notifications: (Subscription procedure prior to ODL v5.0.6) <br>
&nbsp;When subscription is not enabled while mounting the device on the SDN controller,  user can follow below steps to stream <br> the IETF notification from the device to the REST layer. One ssh session will handle both configuration/operation request and notification streams.<br> 
Device level notification supports both http and https, also response will be in json format.	<br>

&nbsp;&nbsp;**Steps to start NETCONF subscription stream for single device** <br>
&nbsp;&nbsp;Step-1: Create a subscription stream using NETCONF for device CO15338
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/network-topology:network-topology/topology=topology-netconf/node=CO15338/yang-ext:mount/notifications:create-subscription 
		BODY		:
				{
					"input":
						{
							"stream":"NETCONF"     
						}  
				}
```	
&nbsp;&nbsp;Step-2: To receive the device notication from the device for the specfied path in the request  
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/odl-device-notification:subscribe-device-notification 
		BODY		:
				{
					"input":
						{
							"path":"/network-topology:network-topology/topology[topology-id='topology-netconf']/node[node-id='CO15338']"
						}   
				}
		Response:
				{
					"odl-device-notification:output": {
						"stream-path": "http://172.28.127.3:8181/rests/notif/CO15338?notificationType=device"
						}
				}
```
&nbsp;&nbsp;Step-3: Copy the url response from step-2, paste it in browser or any rest application which support streaming. <br>
&nbsp;&nbsp;We will get response like below <br>
```
		:ping
		:ping
		:ping
```
&nbsp;Device level notification supports below notifications, <br>
&nbsp;&nbsp;A. [Object create notification](subscription.md#example-for-object-create-notification-on-siae-device)   <br>
&nbsp;&nbsp;B. [Attribute change notification](subscription.md#example-for-attribute-change-notification-on-siae-device)   <br>
&nbsp;&nbsp;C. [Object delete notification](subscription.md#example-for-object-delete-notification-on-siae-device)   <br>
&nbsp;&nbsp;D. [Problem notification](subscription.md#example-for-problemalarm-notification-on-siae-device)   <br>

&nbsp;&nbsp;After subscribing NETCONF stream, above mentioned notifications can be triggered using below steps: <br>
#### Example for Object create notification on SIAE device:	 
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/network-topology:network-topology/topology=topology-netconf/node=513250009/yang-ext:mount/vlan-fd-1-0:create-vlan-fc
		BODY		:
				{ 
					"input":
						{
							"affected-vlan-fd": "VLAN-FD",
							"new-vlan-id": "281"   
						}    
				}
```
&nbsp;&nbsp;Device Notification:
```
		data: {"ietf-restconf:notification":{"vlan-fc-1-0:object-creation-notification":{"object-type":"fc","counter":2,"timestamp":"2023-07-10T12:27:03.0+00:00","object-id-ref":"VLAN-281"}},"event-time":"2023-07-10T12:27:03Z"}
```
	
#### Example for Object delete notification on SIAE device:
```
		Operation	: POST
		URL		: http://172.28.127.3:8181/rests/operations/network-topology:network-topology/topology=topology-netconf/node=513250009/yang-ext:mount/vlan-fd-1-0:delete-vlan-fc
		BODY		:
				{ 
					"input":
						{
							"affected-vlan-fd": "VLAN-FD",
							"obsolete-vlan-fc": "VLAN-281"
						}    
				}
```
&nbsp;&nbsp;Device Notification:
```
		data: {"ietf-restconf:notification":{"vlan-fc-1-0:object-deletion-notification":{"counter":1,"timestamp":"2023-07-13T09:31:48.0+00:00","object-id-ref":"VLAN-281"}},"event-time":"2023-07-13T09:31:48Z"}
```
		
#### Example for attribute change notification on SIAE device: <br>
currently AVC is not delivered by current SIAE package, Netconf config change notification is created for by Netconf server itself
```
		Operation	: PUT
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009/yang-ext:mount/core-model-1-4:control-construct/logical-termination-point=LTP-MWPS-TTP-RADIO-2A/layer-protocol=LP-MWPS-TTP-RADIO-2A/air-interface-2-0:air-interface-pac/air-interface-configuration/air-interface-name
		BODY		:
				{
					"air-interface-2-0:air-interface-name": "Radio-1A"
				}
```
&nbsp;&nbsp;Device Notification:
```
		data: {"ietf-restconf:notification":{"ietf-netconf-notifications:netconf-config-change":{"changed-by":{"username":"sdnctrlr","source-host":"172.28.127.3","session-id":2},"edit":[{"operation":"replace","target":"/core-model-1-4:control-construct/logical-termination-point[uuid='LTP-MWPS-TTP-RADIO-2A']/layer-protocol[local-id='LP-MWPS-TTP-RADIO-2A']/air-interface-2-0:air-interface-pac/air-interface-configuration/air-interface-name"}]}},"event-time":"2023-07-10T15:04:33Z"}
```

#### Example for problem/alarm notification on SIAE device: <br>
```
		Operation	: PUT
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009/yang-ext:mount/core-model-1-4:control-construct/logical-termination-point=LTP-MWPS-TTP-RADIO-2A/layer-protocol=LP-MWPS-TTP-RADIO-2A/air-interface-2-0:air-interface-pac/air-interface-configuration/adaptive-modulation-is-on
		BODY		:
				{
					"air-interface-2-0:adaptive-modulation-is-on": false
				}
```
&nbsp;&nbsp;Device Notification:
```
data: {"ietf-restconf:notification":{"ietf-netconf-notifications:netconf-config-change":{"changed-by":{"username":"admin","source-host":"172.28.127.4","session-id":2},"edit":[{"operation":"replace","target":"/core-model-1-4:control-construct/logical-termination-point[uuid='LTP-MWPS-TTP-RADIO-2A']/layer-protocol[local-id='LP-MWPS-TTP-RADIO-2A']/air-interface-2-0:air-interface-pac/air-interface-configuration/adaptive-modulation-is-on"}]}},"event-time":"2023-07-11T08:44:59Z"}

data: {"ietf-restconf:notification":{"alarms-1-0:alarm-event-notification":{"alarm-event-sequence-number":1,"problem-severity":"alarms-1-0:SEVERITY_AND_CLEARED_TYPE_MAJOR","timestamp":"2023-07-11T08:45:02.0+00:00","resource":"/core-model-1-4:control-construct/logical-termination-point[uuid='LTP-MWPS-TTP-RADIO-1A']/layer-protocol[local-id='LP-MWPS-TTP-RADIO-1A']/air-interface-2-0:air-interface-pac","alarm-type-qualifier":"","alarm-type-id":"siae-alarms-1-0:radioEquipLinkTelemetryFailAlarm"}},"event-time":"2023-07-11T08:45:03Z"}

data: {"ietf-restconf:notification":{"alarms-1-0:alarm-event-notification":{"alarm-event-sequence-number":2,"problem-severity":"alarms-1-0:SEVERITY_AND_CLEARED_TYPE_MAJOR","timestamp":"2023-07-11T08:45:02.0+00:00","resource":"/core-model-1-4:control-construct/logical-termination-point[uuid='LTP-MWPS-TTP-RADIO-1A']/layer-protocol[local-id='LP-MWPS-TTP-RADIO-1A']/air-interface-2-0:air-interface-pac","alarm-type-qualifier":"","alarm-type-id":"siae-alarms-1-0:radioBranchTxPowerAlarm"}},"event-time":"2023-07-11T08:45:04Z"}
```
## Problem persisted on subscription feature before ODL V5.0.6: <br>

Problem during configuring the subscription:<br>
1. Manual steps is required to enable subscription for all devices which are mounted on primary controller. <br>
2. If we need to configure the subscription on secondary controller devices, again we need to manually spend time to configure it. <br>

Problem during failures on various SDN components:<br>

3. In scale setup, device DCN connectivity is teardown and restored, then we need to manually subscribe again for that particular device. <br>
4. If SDN controller is restarted, then need to manually subscribe the subscription for all nodes under that controller.<br>
5. If Mediator application is restarted, then need to manually subscribe the subscription for the nodes on all controllers.<br>
6. If device is restarted, then we need to manually subscribe again for that particular device. <br>

## Features introduced in 5.0.6: (Subscription procedure after ODL v5.0.6)

Below are the features introduced in 5.0.6 to overcome the problem in previous ODL version. <br>

1. Auto-subscription creation when new device is mounted on controller
2. Re-subscription

<br>
<img src="after_odl_5.0.6.JPG">
<br>

#### Auto-subscription creation when new device is mounted on controller: <br>
Problem in configuring the subscription feature in previous ODL version can be overcome by<br>
enabling attributes like netconf-node-optional:ignore-missing-schema-sources, netconf-node-optional:notification <br> while mounting device into controller. 

<em>Mount using PUT request</em><br>
Using below PUT request with subscription true, user can mount the device with active subscription session on the controller.
```
		Operation	: PUT
		URL		: http://172.28.127.3:8181/rests/data/network-topology:network-topology/topology=topology-netconf/node=513250009
		BODY		:
			{
				"network-topology:node": [
				{
				"node-id": "513250009",
				"netconf-node-topology:sleep-factor": "2.5",
				"netconf-node-topology:max-connection-attempts": 8,
				"netconf-node-topology:username": "admin",
				"netconf-node-topology:password": "admin",
				"netconf-node-topology:default-request-timeout-millis": 900000,
				"netconf-node-topology:schema-cache-directory": "siae_alcp2e",
				"netconf-node-topology:between-attempts-timeout-millis": 5000,
				"netconf-node-topology:port": 33001,
				"netconf-node-topology:reconnect-on-changed-schema": false,
				"netconf-node-topology:tcp-only": false,
				"netconf-node-topology:keepalive-delay": 120,
				"netconf-node-topology:concurrent-rpc-limit": 0,
				"netconf-node-topology:host": "172.28.127.8",
				"netconf-node-optional:ignore-missing-schema-sources": {
					"reconnect-time": 2000,
					"allowed": true
				},
				"netconf-node-optional:notification": {
					"subscribe": true,
					"stream-name": "NETCONF"
				}
			}
    ]
}
``` 
<em>Mount using csv file</em><br>
Below are steps to mount devices on SDN controller with subscription enable using csv file <br>

Step-1: Create a csv file with mountname, netconf port, mediator IP, username, password, etc. <br>
Sample csv file attached here: [sample_mount_csv](mount-points0.csv) <br>

Step-2: Once all device is added into csv file then place the file into path : /home/sdnr/workspace/sdnr-deployment-configurations/sdnr-config/netconf-topology/ <br>

Step-3: Bring the SDN controller down using below command  <br>
```
cd /home/sdnr/workspace/sdnr-deployment-configurations
docker-compose down
```
Step-4: Bring the SDN controller up using below command 
```
cd /home/sdnr/workspace/sdnr-deployment-configurations
docker-compose up -d
```

#### Re-subscription:

Resubscription feature is enabled on the device when device is started to mount on the controller. Even when device is disconnected and <br> reconnected with SDN controller, no manual action/steps to re-configure the device level subscription. <br>
Since subscription is enabled globally while mounting the device, we cannot expect streaming for specific path from device modelling. <br>

Problem in device subscription failures during various component can be overcome by using below url directly on browser or any rest application<br> 
<br>
**Device Subscription url**
```
http://172.28.127.3:8181/rests/notif/513250009?notificationType=device
```
In browser, events will capture like below <br>
<br>
<img src="device_subscription.JPG">
<br>

[Up to Main](../Main/Main.md)
